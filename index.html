<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optical Art Generator</title>
    <link rel="stylesheet" href="styles.css">
    <!-- FFmpeg.wasm for video export - UMD bundle loaded locally -->
    <script src="/ffmpeg-umd.js"></script>
    <script>
        // FFmpeg is now available as window.FFmpegWASM.FFmpeg
        if (window.FFmpegWASM) {
            window.FFmpeg = window.FFmpegWASM.FFmpeg;
            console.log('✅ FFmpeg UMD loaded');
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Optical Art Generator</h1>
            <p>Generate mesmerizing geometric patterns for laser engraving</p>
        </header>

        <div class="main-content">
            <div class="controls-panel">
                <div class="tabs-nav">
                    <button class="tab-link active" data-tab="tab-pattern">Pattern</button>
                    <button class="tab-link" data-tab="tab-adjust">Adjust</button>
                    <button class="tab-link" data-tab="tab-canvas">Canvas & Color</button>
                    <button class="tab-link" data-tab="tab-explore">Explore</button>
                    <button class="tab-link" data-tab="tab-morph">Morph</button>
                    <button class="tab-link" data-tab="tab-actions">Actions</button>
                </div>

                <!-- Tab Content -->
                <div id="tab-pattern" class="tab-content active">
                    <div class="control-group">
                        <label for="pattern-type">Pattern Type:</label>
                        <select id="pattern-type">
                            <option value="wave-displacement" selected>Wave Displacement</option>
                            <option value="circular-displacement">Circular Displacement</option>
                            <option value="perlin-displacement">Perlin Displacement</option>
                            <option value="fractal-noise">Fractal Noise</option>
                            <option value="de-jong-attractor">De Jong Attractor</option>
                            <option value="cellular-automata">Cellular Automata</option>
                            <option value="l-system-growth">L-System Growth</option>
                            <option value="eye-pattern">Eye Pattern</option>
                            <option value="moire-interference">Moiré Interference</option>
                            <option value="spiral-distortion">Spiral Distortion</option>
                            <option value="concentric-circles">Concentric Circles</option>
                            <option value="diagonal-stripes">Diagonal Stripes</option>
                            <option value="cube-illusion">Cube Illusion</option>
                            <option value="square-tunnel">Square Tunnel</option>
                            <option value="shaded-grid">Shaded Grid</option>
                            <option value="radial-vortex">Radial Vortex</option>
                        </select>
                        <div id="pattern-previews" class="pattern-preview-grid">
                            <!-- Preview thumbnails will be generated here -->
                        </div>
                    </div>
                    <div class="info-panel">
                        <h3>Pattern Info</h3>
                        <p id="pattern-info">Select a pattern type to see details</p>
                    </div>
                </div>

                <div id="tab-adjust" class="tab-content">
                    <div class="control-group">
                        <label for="complexity">Complexity:</label>
                        <input type="range" id="complexity" min="5" max="300" value="50">
                        <span id="complexity-value">50</span>
                        <input type="checkbox" id="animate-complexity" class="animate-checkbox">
                        <label for="animate-complexity" class="animate-label">🎬</label>
                    </div>
                    <div class="control-group">
                        <label for="symmetry">Symmetry:</label>
                        <select id="symmetry">
                            <option value="none">None</option>
                            <option value="2">2-Fold Mirror</option>
                            <option value="4">4-Fold</option>
                            <option value="6">6-Fold</option>
                            <option value="8">8-Fold</option>
                            <option value="12">Radial (12-Fold)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="frequency">Pattern Frequency:</label>
                        <input type="range" id="frequency" min="1" max="100" value="4">
                        <span id="frequency-value">4</span>
                        <input type="checkbox" id="animate-frequency" class="animate-checkbox">
                        <label for="animate-frequency" class="animate-label">🎬</label>
                    </div>
                    <div class="control-group">
                        <label for="amplitude">Pattern Amplitude:</label>
                        <input type="range" id="amplitude" min="-1000" max="1000" value="20">
                        <span id="amplitude-value">+20</span>
                        <input type="checkbox" id="animate-amplitude" class="animate-checkbox">
                        <label for="animate-amplitude" class="animate-label">🎬</label>
                    </div>
                    <div class="control-group">
                        <label for="rotation">Pattern Rotation:</label>
                        <input type="range" id="rotation" min="-180" max="180" value="0">
                        <span id="rotation-value">0°</span>
                        <input type="checkbox" id="animate-rotation" class="animate-checkbox" checked>
                        <label for="animate-rotation" class="animate-label">🎬</label>
                    </div>
                    <div class="control-group">
                        <label for="glow">Glow Intensity:</label>
                        <input type="range" id="glow" min="0" max="10" value="0">
                        <span id="glow-value">0</span>
                        <input type="checkbox" id="animate-glow" class="animate-checkbox">
                        <label for="animate-glow" class="animate-label">🎬</label>
                    </div>
                    <div class="control-group animate-controls">
                        <label for="animation-speed">Animation Speed:</label>
                        <input type="range" id="animation-speed" min="0.1" max="10" step="0.1" value="1">
                        <span id="animation-speed-value">1.0x</span>
                    </div>
                    <div class="control-group">
                        <label>Zoom & Pan:</label>
                        <div class="button-group-inline">
                            <button id="zoom-in-btn" class="secondary-btn">Zoom In</button>
                            <button id="zoom-out-btn" class="secondary-btn">Zoom Out</button>
                            <button id="reset-zoom-btn" class="secondary-btn">Reset Zoom</button>
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="generate-btn" class="primary-btn">Generate New</button>
                        <button id="variation-btn" class="secondary-btn">Generate Variation</button>
                        <button id="randomize-all-btn" class="secondary-btn">🎲 Randomize All</button>
                        <button id="reset-all-btn" class="secondary-btn">↺ Reset All</button>
                        <button id="layer-btn" class="secondary-btn">Layer Pattern</button>
                    </div>
                </div>

                <div id="tab-canvas" class="tab-content">
                    <div class="control-group">
                        <label for="format-preset">Format Preset:</label>
                        <select id="format-preset">
                            <option value="custom">Custom Size</option>
                            <option value="1:1" selected>Square (1:1)</option>
                            <option value="16:9">Widescreen (16:9)</option>
                            <option value="9:16">Portrait (9:16)</option>
                            <option value="3:4">Traditional (3:4)</option>
                            <option value="4:3">Landscape (4:3)</option>
                            <option value="2:3">Photo (2:3)</option>
                            <option value="3:2">Photo Landscape (3:2)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="size">Base Size (mm):</label>
                        <input type="number" id="size" min="50" max="1000" value="350" step="10">
                        <span class="unit-label">mm</span>
                    </div>
                    <div class="control-group">
                        <div class="size-display">
                            <span>Canvas: </span>
                            <span id="canvas-dimensions">100×100 mm</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <button id="generate-colors-btn" class="primary-btn">🎨 Generate Colors</button>
                    </div>
                    <div class="control-group">
                        <label for="color-mode">Color Mode:</label>
                        <select id="color-mode">
                            <option value="black">Black Lines (LightBurn)</option>
                            <option value="artistic">Artistic Palettes</option>
                            <option value="custom-gradient">Custom Gradient</option>
                            <option value="single">Single Color</option>
                            <option value="gradient">Gradient Lines</option>
                            <option value="rainbow">Rainbow Lines</option>
                            <option value="hue-shift">Hue Shift</option>
                        </select>
                    </div>
                    <div class="control-group" id="single-color-group" style="display: none;">
                        <label for="line-color">Line Color:</label>
                        <input type="color" id="line-color" value="#ff0000">
                    </div>
                    <div class="control-group" id="custom-gradient-group" style="display: none;">
                        <label for="gradient-color-1">Gradient Start:</label>
                        <input type="color" id="gradient-color-1" value="#ff00ff">
                        <label for="gradient-color-2">Gradient End:</label>
                        <input type="color" id="gradient-color-2" value="#00ffff">
                    </div>
                </div>

                <div id="tab-explore" class="tab-content">
                    <div class="explorer-header">
                        <h4>🎨 Visual Explorer</h4>
                        <p class="explorer-hint">Click your favorite → Evolve toward beauty!</p>
                        <div class="explorer-controls">
                            <button id="new-generation-btn" class="secondary-btn">↺ New Generation</button>
                            <button id="use-variant-btn" class="primary-btn" disabled>✓ Use This</button>
                        </div>
                        <div class="generation-info">
                            <span id="generation-counter">Generation 1 - Random</span>
                        </div>
                    </div>
                    <div class="variants-grid" id="variants-grid">
                        <!-- Variants will be dynamically generated here -->
                    </div>
                </div>

                <div id="tab-morph" class="tab-content">
                    <div class="preset-group">
                        <h4>⚡ Quick Presets</h4>
                        <p class="preset-hint">Tap slot to load • Tap 💾 to save • Ctrl+[1-9] to save (desktop)</p>
                        <div class="preset-slots">
                            <div class="preset-slot-container">
                                <button class="preset-slot" data-slot="1">1<span class="preset-status">Empty</span></button>
                                <button class="preset-save-btn" data-slot="1" title="Save to Preset 1">💾</button>
                            </div>
                            <div class="preset-slot-container">
                                <button class="preset-slot" data-slot="2">2<span class="preset-status">Empty</span></button>
                                <button class="preset-save-btn" data-slot="2" title="Save to Preset 2">💾</button>
                            </div>
                            <div class="preset-slot-container">
                                <button class="preset-slot" data-slot="3">3<span class="preset-status">Empty</span></button>
                                <button class="preset-save-btn" data-slot="3" title="Save to Preset 3">💾</button>
                            </div>
                            <div class="preset-slot-container">
                                <button class="preset-slot" data-slot="4">4<span class="preset-status">Empty</span></button>
                                <button class="preset-save-btn" data-slot="4" title="Save to Preset 4">💾</button>
                            </div>
                            <div class="preset-slot-container">
                                <button class="preset-slot" data-slot="5">5<span class="preset-status">Empty</span></button>
                                <button class="preset-save-btn" data-slot="5" title="Save to Preset 5">💾</button>
                            </div>
                            <div class="preset-slot-container">
                                <button class="preset-slot" data-slot="6">6<span class="preset-status">Empty</span></button>
                                <button class="preset-save-btn" data-slot="6" title="Save to Preset 6">💾</button>
                            </div>
                            <div class="preset-slot-container">
                                <button class="preset-slot" data-slot="7">7<span class="preset-status">Empty</span></button>
                                <button class="preset-save-btn" data-slot="7" title="Save to Preset 7">💾</button>
                            </div>
                            <div class="preset-slot-container">
                                <button class="preset-slot" data-slot="8">8<span class="preset-status">Empty</span></button>
                                <button class="preset-save-btn" data-slot="8" title="Save to Preset 8">💾</button>
                            </div>
                            <div class="preset-slot-container">
                                <button class="preset-slot" data-slot="9">9<span class="preset-status">Empty</span></button>
                                <button class="preset-save-btn" data-slot="9" title="Save to Preset 9">💾</button>
                            </div>
                        </div>
                        <div class="preset-controls">
                            <button id="mutate-btn" class="secondary-btn">🎲 Mutate Settings</button>
                            <button id="clear-presets-btn" class="secondary-btn">Clear All Presets</button>
                        </div>
                    </div>
                    <div class="morph-group">
                        <h4>🔄 A/B Morph</h4>
                        <div class="morph-controls">
                            <select id="morph-preset-a">
                                <option value="">Select Preset A</option>
                            </select>
                            <select id="morph-preset-b">
                                <option value="">Select Preset B</option>
                            </select>
                        </div>
                        <div class="morph-slider-container">
                            <label for="morph-slider">Morph: <span id="morph-value">50%</span></label>
                            <input type="range" id="morph-slider" min="0" max="100" value="50">
                        </div>
                        <button id="apply-morph-btn" class="primary-btn">Apply Morph</button>
                    </div>
                </div>

                <div id="tab-actions" class="tab-content">
                    <div class="save-load-group">
                        <h4>Pattern Library</h4>
                        <button id="save-pattern-btn" class="secondary-btn">Save Pattern</button>
                        <button id="load-pattern-btn" class="secondary-btn">Load Pattern</button>
                        <button id="manage-patterns-btn" class="secondary-btn">Manage Saved</button>
                    </div>
                    <div class="export-group">
                        <h4>Export Options</h4>
                        <button id="export-svg-btn" class="export-btn">Export SVG (LightBurn)</button>
                        <button id="export-png-btn" class="export-btn">Export PNG (Wallpaper)</button>
                        <button id="export-jpg-btn" class="export-btn">Export JPG (Wallpaper)</button>
                    </div>
                    <div class="video-export-group">
                        <h4>🎬 Video Export</h4>
                        <p class="video-hint">📹 FFmpeg H.264 encoder (QuickTime compatible)</p>
                        <div class="video-controls">
                            <label for="video-duration">Duration:</label>
                            <select id="video-duration">
                                <option value="5">5 seconds</option>
                                <option value="10" selected>10 seconds</option>
                                <option value="15">15 seconds</option>
                            </select>
                        </div>
                        <div class="video-controls">
                            <label for="video-quality">Quality:</label>
                            <select id="video-quality">
                                <option value="1080">HD (1920x1080)</option>
                                <option value="1440">2K (2560x1440)</option>
                                <option value="2160" selected>4K (3840x2160)</option>
                            </select>
                        </div>
                        <div class="video-controls">
                            <label for="animation-mode">Animation:</label>
                            <select id="animation-mode">
                                <option value="bounce" selected>🔄 Bounce (oscillate)</option>
                                <option value="loop">➡️ Loop (continuous)</option>
                            </select>
                        </div>
                        <button id="record-video-btn" class="export-btn">🎥 Record Video (10s)</button>
                        <div id="video-progress" class="video-progress" style="display: none;">
                            <div class="progress-bar-container">
                                <div id="video-progress-bar" class="progress-bar"></div>
                            </div>
                            <p id="video-status" class="video-status">Preparing...</p>
                        </div>
                        <p class="video-note">⚠️ First use will download ~30MB FFmpeg library (one-time)</p>
                    </div>
                </div>
            </div>

            <div class="canvas-container">
                <svg id="art-canvas" width="600" height="600" viewBox="0 0 600 600">
                    <!-- Generated patterns will appear here -->
                </svg>
            </div>
        </div>

        <footer>
            <p>Compatible with LightBurn laser engraving software</p>
        </footer>
    </div>

    <!-- Save Pattern Modal -->
    <div id="saveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Save Pattern</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" id="pattern-name" class="pattern-name-input" placeholder="Enter pattern name...">
                <button id="confirm-save-btn" class="primary-btn">Save Pattern</button>
            </div>
        </div>
    </div>

    <!-- Manage Patterns Modal -->
    <div id="manageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Saved Patterns</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="saved-patterns-container" class="saved-patterns-grid">
                    <!-- Saved patterns will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>